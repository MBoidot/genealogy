
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Genealogy Radial Tree</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
body { margin:0; padding:20px; font-family:Arial,sans-serif; background:#f5f5f5; display:flex; flex-direction:column; align-items:center; }
#chart { background:white; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.15); }
.tooltip { position:absolute; background:#333; color:white; padding:8px 12px; border-radius:4px; font-size:12px; pointer-events:none; display:none; z-index:1000; box-shadow:0 2px 8px rgba(0,0,0,0.3); }
.node circle { stroke-width:2px; }
.node text { font-size:12px; pointer-events:none; text-anchor:middle; dominant-baseline:middle; }
.node.dead circle { fill:white; }
.decade-ring { fill:none; stroke:#ccc; stroke-width:1px; stroke-dasharray:3,3; opacity:0.5; }
.decade-label { font-size:11px; fill:#999; pointer-events:none; }
.link { fill:none; stroke:#999; stroke-opacity:0.4; }
#slider-container { margin:20px; display:flex; align-items:center; gap:10px; font-size:14px; }
</style>
</head>
<body>

<div id="slider-container">
    <label for="rotation-slider">Rotate Tree:</label>
    <input type="range" id="rotation-slider" min="0" max="360" value="0">
</div>

<div id="chart"></div>
<div class="tooltip"></div>

<script>
const data = {"name": "Henry\u00a0 BOIDOT", "id": 1, "birth": "14/01/1919", "death": "22/01/2002\u00a0", "gen": 0, "children": [{"name": "Jean-Paul\u00a0 BOIDOT", "id": 3, "birth": "12/06/1941", "death": "25/03/2015\u00a0", "gen": 1, "children": [{"name": "V\u00e9ronique\u00a0 BOIDOT", "id": 5, "birth": "31/03/1964", "death": "", "gen": 2, "children": [], "isSpouse": false}, {"name": "Catherine\u00a0 BOIDOT-MILAN", "id": 6, "birth": "28/05/1968", "death": "", "gen": 2, "children": [{"name": "Marion\u00a0 MILAN", "id": 8, "birth": "31/03/1997", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Tanguy\u00a0 MILAN", "id": 9, "birth": "14/10/2000", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Bastien\u00a0 MILAN", "id": 10, "birth": "08/11/1998", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Clara\u00a0 MILAN", "id": 11, "birth": "17/07/2004", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Marc\u00a0 MILAN", "id": 7, "birth": "11/11/1966", "death": "", "gen": 2, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "H\u00e9l\u00e8ne\u00a0 BOIDOT-DILLENSEGER", "id": 12, "birth": "09/06/1969", "death": "", "gen": 2, "children": [{"name": "Cl\u00e9ment DILLENSEGER", "id": 14, "birth": "17/09/1999", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Camille DILLENSEGER", "id": 15, "birth": "15/09/2002", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Rodolphe\u00a0 DILLENSEGER", "id": 13, "birth": "07/01/1970", "death": "", "gen": 2, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Anne-Marie\u00a0 BOIDOT-FAUSSOT", "id": 4, "birth": "01/01/1945", "death": "", "gen": 1, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Fran\u00e7ois\u00a0 BOIDOT", "id": 16, "birth": "07/06/1943", "death": "", "gen": 1, "children": [{"name": "Fr\u00e9d\u00e9rique\u00a0 BOIDOT-LELIEVRE", "id": 18, "birth": "03/09/1970", "death": "", "gen": 2, "children": [{"name": "Gabin\u00a0 LELIEVRE", "id": 20, "birth": "05/02/2002", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Lucile\u00a0 LELIEVRE", "id": 21, "birth": "05/02/2002", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Vincent\u00a0 LELIEVRE", "id": 19, "birth": "10/04/1966", "death": "", "gen": 2, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Brigitte\u00a0 ROYANT", "id": 17, "birth": "29/07/1952", "death": "", "gen": 1, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Jean-Pierre\u00a0 BOIDOT", "id": 22, "birth": "25/08/1944", "death": "", "gen": 1, "children": [{"name": "Florence\u00a0 BOIDOT", "id": 24, "birth": "04/02/1968", "death": "", "gen": 2, "children": [], "isSpouse": false}, {"name": "Delphine\u00a0 BOIDOT", "id": 25, "birth": "16/10/1970", "death": "", "gen": 2, "children": [{"name": "Joshua\u00a0 BRADLEY", "id": 27, "birth": "01/02/2002", "death": "", "gen": 3, "children": [], "isSpouse": false}], "isSpouse": false}, {"name": "Claudine\u00a0 BOIDOT-DUFOUR", "id": 23, "birth": "17/05/1948", "death": "", "gen": 1, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Martine\u00a0 BOIDOT", "id": 28, "birth": "28/08/1945", "death": "", "gen": 1, "children": [{"name": "Jacques\u00a0 POTY", "id": 29, "birth": "23/01/1950", "death": "", "gen": 1, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Patrick\u00a0 BOIDOT", "id": 30, "birth": "01/08/1947", "death": "", "gen": 1, "children": [{"name": "Julien\u00a0 BOIDOT", "id": 32, "birth": "28/08/1981", "death": "", "gen": 2, "children": [{"name": "Diane\u00a0 BOIDOT", "id": 34, "birth": "26/11/2011", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Ir\u00e8ne\u00a0 BOIDOT", "id": 35, "birth": "16/11/2014", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Sandra\u00a0 LEROUX", "id": 33, "birth": "10/01/1981", "death": "", "gen": 2, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Mathieu\u00a0 BOIDOT", "id": 36, "birth": "01/09/1983", "death": "", "gen": 2, "children": [{"name": "Paulin\u00a0 BOIDOT", "id": 38, "birth": "08/12/2012", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Victor\u00a0 BOIDOT", "id": 39, "birth": "22/04/2015", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Ga\u00eblle\u00a0 UZU", "id": 37, "birth": "25/08/1982", "death": "", "gen": 2, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Claudie\u00a0 BOISSEAU", "id": 31, "birth": "16/10/1947", "death": "", "gen": 1, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Marie-Christine BOIDOT-BURET", "id": 40, "birth": "20/10/1948", "death": "", "gen": 1, "children": [{"name": "Anne\u00a0 BURET", "id": 42, "birth": "05/08/1972", "death": "", "gen": 2, "children": [{"name": "Ewen\u00a0 BOURSE", "id": 43, "birth": "09/03/2005", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Ethan\u00a0 BOURSE", "id": 44, "birth": "04/04/2010", "death": "", "gen": 3, "children": [], "isSpouse": false}], "isSpouse": false}, {"name": "Caroline\u00a0 BURET", "id": 45, "birth": "02/01/1979", "death": "", "gen": 2, "children": [], "isSpouse": false}, {"name": "Yvon\u00a0\u00a0 BURET", "id": 41, "birth": "28/02/1947", "death": "", "gen": 1, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Christian\u00a0 BOIDOT", "id": 46, "birth": "15/12/1949", "death": "", "gen": 1, "children": [{"name": "Sandrine\u00a0 BOIDOT", "id": 48, "birth": "03/05/1973", "death": "", "gen": 2, "children": [{"name": "Jonathan de Carvalho", "id": 99, "birth": "15/01/1992", "death": "", "gen": 3, "children": [{"name": "Louise de Carvalho", "id": 101, "birth": "16/04/2023", "death": "", "gen": 4, "children": [], "isSpouse": false}, {"name": "Alicia MESTRE", "id": 100, "birth": "01/01/1995", "death": "", "gen": 3, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Dany de Carvalho", "id": 102, "birth": "04/12/1993", "death": "", "gen": 3, "children": [{"name": "Rakel de Carvalho", "id": 104, "birth": "25/12/2022", "death": "", "gen": 4, "children": [], "isSpouse": false}, {"name": "Elodie PERIAU", "id": 103, "birth": "01/01/1997", "death": "", "gen": 3, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Dylan de Carvalho", "id": 105, "birth": "21/08/1999", "death": "", "gen": 3, "children": [{"name": "Conjointe Garcon 3 sandrine ??", "id": 106, "birth": "01/01/1999", "death": "", "gen": 3, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Francisco Ferreira de Carvalho", "id": 96, "birth": "02/12/1973", "death": "", "gen": 2, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Richard\u00a0 BOIDOT", "id": 49, "birth": "06/06/1974", "death": "", "gen": 2, "children": [{"name": "Az\u00e9lie BOIDOT", "id": 94, "birth": "13/03/2004", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Iphyg\u00e9nie BOIDOT", "id": 95, "birth": "16/10/2010", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Ludivine\u00a0 LAGRES", "id": 93, "birth": "", "death": "", "gen": 2, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "H\u00e9loise\u00a0 LETINTURIER", "id": 89, "birth": "04/10/2001", "death": "", "gen": 2, "children": [], "isSpouse": false}, {"name": "Jacqueline LETINTURIER", "id": 98, "birth": "15/12/1949", "death": "", "gen": 1, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Fran\u00e7oise\u00a0 BOIDOT-GOAS", "id": 50, "birth": "21/07/1953", "death": "", "gen": 1, "children": [{"name": "Claire\u00a0 GOAS-MAFFRE", "id": 52, "birth": "03/07/1984", "death": "", "gen": 2, "children": [{"name": "Mathilde MAFFRE", "id": 54, "birth": "14/02/2010", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Arthur MAFFRE", "id": 55, "birth": "27/03/2013", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Thomas\u00a0 MAFFRE", "id": 56, "birth": "12/10/2015", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Henry\u00a0 MAFFRE", "id": 57, "birth": "10/07/2019", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Guillaume\u00a0 MAFFRE", "id": 53, "birth": "02/12/1977", "death": "", "gen": 2, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Isabelle\u00a0 GOAS-CANTY", "id": 58, "birth": "08/06/1987", "death": "", "gen": 2, "children": [{"name": "Jeanne CANTY", "id": 60, "birth": "12/10/2014", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Cl\u00e9mence\u00a0 CANTY", "id": 61, "birth": "27/03/2019", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "J\u00e9r\u00e9mie\u00a0 CANTY", "id": 59, "birth": "07/06/1985", "death": "", "gen": 2, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Yves\u00a0 GOAS", "id": 51, "birth": "13/08/1953", "death": "", "gen": 1, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Anne-Marie\u00a0 BOIDOT", "id": 62, "birth": "20/07/1954", "death": "", "gen": 1, "children": [{"name": "Nicolas\u00a0 MILAN", "id": 64, "birth": "25/04/1986", "death": "", "gen": 2, "children": [{"name": "Timoth\u00e9e\u00a0\u00a0 MILAN", "id": 65, "birth": "29/03/2018", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Charlie\u00a0\u00a0 MILAN", "id": 66, "birth": "01/12/2021", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Am\u00e9lie BARRET", "id": 91, "birth": "", "death": "", "gen": 2, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Marie-Anne\u00a0 MILAN", "id": 67, "birth": "27/12/1988", "death": "", "gen": 2, "children": [{"name": "Paul\u00a0 CARONI", "id": 69, "birth": "30/03/2017", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Agnes\u00a0\u00a0 CARONI", "id": 70, "birth": "09/02/2020", "death": "", "gen": 3, "children": [], "isSpouse": false}], "isSpouse": false}, {"name": "Ren\u00e9\u00a0 MILAN", "id": 71, "birth": "01/07/1990", "death": "", "gen": 2, "children": [{"name": "Louis\u00a0 MILAN", "id": 73, "birth": "06/03/2017", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Anaelle\u00a0 MILAN", "id": 74, "birth": "02/07/2019", "death": "", "gen": 3, "children": [], "isSpouse": false}], "isSpouse": false}, {"name": "Cl\u00e9mence\u00a0 MILAN", "id": 75, "birth": "12/08/1992", "death": "", "gen": 2, "children": [{"name": "Marceau\u00a0 MAGERE", "id": 77, "birth": "15/02/2025", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Nicolas\u00a0 MAGERE", "id": 76, "birth": "?\u00a0", "death": "", "gen": 2, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Pierre\u00a0 MILAN", "id": 63, "birth": "16/08/1958", "death": "", "gen": 1, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Michel\u00a0 BOIDOT", "id": 78, "birth": "17/07/1957", "death": "", "gen": 1, "children": [{"name": "Virginie\u00a0 BOIDOT-MINERVINI", "id": 80, "birth": "23/12/1986", "death": "", "gen": 2, "children": [{"name": "Sacha\u00a0 MINERVINI", "id": 82, "birth": "13/08/2017", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Simon\u00a0 MINERVINI", "id": 83, "birth": "09/01/2021", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Lucas\u00a0 MINERVINI", "id": 81, "birth": "07/09/1985", "death": "", "gen": 2, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Thomas\u00a0 BOIDOT", "id": 84, "birth": "24/06/1992", "death": "", "gen": 2, "children": [{"name": "Milo\u00a0 BOIDOT", "id": 86, "birth": "16/01/2025", "death": "", "gen": 3, "children": [], "isSpouse": false}, {"name": "Lucie\u00a0 ??", "id": 85, "birth": "04/05/1984", "death": "", "gen": 2, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Sylvie\u00a0 BOIDOT-ROSSIGNOL", "id": 79, "birth": "21/11/1961", "death": "", "gen": 1, "children": [], "isSpouse": true}], "isSpouse": false}, {"name": "Simone\u00a0 DURAND", "id": 2, "birth": "08/07/1919", "death": "22/11/2004\u00a0", "gen": 0, "children": [], "isSpouse": true}], "isSpouse": false};

const width = 1200;
const height = 1200;
const radius = Math.min(width, height)/2 - 80; // extra space

const svg = d3.select("#chart").append("svg").attr("width", width).attr("height", height);
const g = svg.append("g").attr("transform", `translate(${width/2},${height/2})`);
const tooltip = d3.select(".tooltip");

// Color scale by generation
const colorScale = d3.scaleOrdinal().domain([0,1,2,3,4]).range(["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8"]);

// Collect birth years
const birthDates = [];
function getAllPersons(node) {
    birthDates.push(node);
    if(node.children) node.children.forEach(getAllPersons);
}
getAllPersons(data);

const birthYears = birthDates.map(p => {
    if(p.birth && p.birth.trim()) {
        const parts = p.birth.trim().split('/');
        if(parts.length >= 3) return parseInt(parts[2]);
    }
    return null;
}).filter(y=>y!==null);

const minYear = Math.min(...birthYears);
const maxYear = Math.max(...birthYears);
const yearRange = maxYear - minYear || 1;

// Add decade rings
const decadeRings = g.append("g").attr("class","decade-rings");
for(let decade=Math.floor(minYear/10)*10; decade<=maxYear; decade+=10) {
    const decadeRadius = ((decade-minYear)/yearRange)*radius;
    if(decadeRadius>0 && decadeRadius<radius) {
        decadeRings.append("circle").attr("class","decade-ring").attr("r",decadeRadius);
        decadeRings.append("text").attr("class","decade-label").attr("x",0).attr("y",-decadeRadius)
            .attr("text-anchor","middle").attr("dominant-baseline","middle").text(decade);
    }
}

// Radius function
function getRadiusByBirth(birthStr) {
    if(!birthStr || !birthStr.trim()) return radius*0.5;
    const parts = birthStr.trim().split('/');
    if(parts.length >= 3) {
        const year = parseInt(parts[2]);
        if(!isNaN(year)) return ((year-minYear)/yearRange)*radius;
    }
    return radius*0.5;
}

// Tree layout
const tree = d3.tree().size([2*Math.PI,1]).separation((a,b)=>(a.parent===b.parent?2:3)/a.depth);
const root = d3.hierarchy(data);
tree(root);

// Assign radial positions and offsets
const spouseAngleDelta = 0.05;
root.each(node => {
    if(node.data.id===1 || node.data.id===2) {
        node.y = 0;
        node.xOffset = 0;
    } else {
        node.y = getRadiusByBirth(node.data.birth);
        node.xOffset = node.data.isSpouse ? spouseAngleDelta : 0;
    }
});

// Draw links
const linkElements = g.selectAll(".link").data(root.links()).join("path").attr("class","link")
    .attr("d", d3.linkRadial().angle(d=>d.x + (d.xOffset||0)).radius(d=>d.y));

// Draw nodes
const nodes = g.selectAll(".node").data(root.descendants()).join("g")
    .attr("class", d=>"node"+(d.data.death?" dead":""));

// Circle styling
nodes.append("circle")
    .attr("r", d => d.data.isSpouse ? 4.5 : (d.data.gen===0?10:(d.children?6:4.5)))
    .attr("fill","white")
    .attr("stroke", d => colorScale(d.data.gen))
    .attr("stroke-width", 2.5);

// Text
function estimateTextWidth(text,fontSize) { return text.length*fontSize*0.55+12; }
nodes.append("text")
    .attr("dy","0.31em")
    .text(d=> {
        if(d.data.id===1 || d.data.id===2) return d.data.name;
        return d.data.name.split(' ')[0];
    })
    .attr("font-weight",d=>d.data.gen===0?"bold":"normal")
    .attr("font-size",d=>d.data.gen===0?"14px":"12px");

// Tooltip
nodes.on("mouseenter", function(event,d) {
    let info=d.data.name;
    if(d.data.isSpouse) info += " (spouse)";
    info+=`<br/>Gen: ${d.data.gen}`;
    if(d.data.birth) info+=`<br/>b: ${d.data.birth}`;
    if(d.data.death) info+=`<br/>d: ${d.data.death}`;
    tooltip.html(info).style("left",(event.pageX+10)+"px").style("top",(event.pageY-10)+"px").style("display","block");
}).on("mouseleave",function(){ tooltip.style("display","none"); });


// Click to highlight descendants
nodes.on("click", function(event, d) {
    // Reset previous highlights
    nodes.select("circle").attr("stroke-width", 2.5).attr("stroke", d => colorScale(d.data.gen));
    nodes.select("text").attr("font-weight", d => d.data.gen===0 ? "bold" : "normal");
    linkElements.attr("stroke", "#999").attr("stroke-width", 1);

    // Get all descendants of the clicked node
    const descendants = d.descendants();

    // Highlight descendants
    descendants.forEach(node => {
        // Highlight node circle
        d3.select(nodes.filter(n => n === node).node()).select("circle")
            .attr("stroke-width", 4)
            .attr("stroke", "black");

        // Highlight text
        d3.select(nodes.filter(n => n === node).node()).select("text")
            .attr("font-weight", "bold");
    });

    // Highlight links connecting descendants
    linkElements
        .filter(l => descendants.includes(l.source) && descendants.includes(l.target))
        .attr("stroke", "black")   // make line black
        .attr("stroke-width", 2);  // thicker line
});

// Rotation slider
const slider = document.getElementById("rotation-slider");

function updateRotation(angleDeg) {
    const angleRad = angleDeg * Math.PI / 180;

    nodes.attr("transform", d => {
        if(d.data.gen === 0) {
            // Gen0 nodes at the center, horizontal
            return `translate(0,0)`;
        } else {
            const angle = d.x + (d.xOffset||0) + angleRad;
            return `rotate(${angle*180/Math.PI-90})translate(${d.y},0)`;
        }
    });

    linkElements.attr("d", d3.linkRadial().angle(d => d.x + (d.xOffset||0) + angleRad).radius(d => d.y));

    nodes.select("text").attr("transform", d => {
        if(d.data.id===1) return `translate(0,-28)`;
        if(d.data.id===2) return `translate(0,-12)`;
        if(d.data.gen===0) return `translate(0,-20)`; // center, horizontal

        const angle = d.x + (d.xOffset||0) + angleRad;
        const deg = angle * 180 / Math.PI - 90;

        const displayText = d.data.name.split(' ')[0];
        const fontSize = d.data.gen===0 ? 14 : 12;
        const offsetDist = estimateTextWidth(displayText,fontSize)/2;

        let x=offsetDist, y=deg>90 && deg<270 ? 4 : -4;
        let rotation = deg>90 && deg<270 ? 180 : 0;

        return `translate(${x},${y})rotate(${rotation})`;
    });
}

// Initialize
updateRotation(0);
slider.addEventListener("input", () => updateRotation(slider.value));

</script>
</body>
</html>
